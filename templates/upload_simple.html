<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Document - StudyPlan AI</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff', 100: '#e0f2fe', 200: '#bae6fd', 300: '#7dd3fc', 400: '#38bdf8',
                            500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1', 800: '#075985', 900: '#0c4a6e',
                        },
                        secondary: {
                            50: '#ecfdf5', 100: '#d1fae5', 200: '#a7f3d0', 300: '#6ee7b7', 400: '#34d399',
                            500: '#10b981', 600: '#059669', 700: '#047857', 800: '#065f46', 900: '#064e3b',
                        },
                        neutral: {
                            50: '#fafafa', 100: '#f5f5f5', 200: '#e5e5e5', 300: '#d4d4d4', 400: '#a3a3a3',
                            500: '#737373', 600: '#525252', 700: '#404040', 800: '#262626', 900: '#171717',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 2px 15px -3px rgba(0, 0, 0, 0.07), 0 10px 20px -2px rgba(0, 0, 0, 0.04)',
                        'medium': '0 4px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
                        'large': '0 10px 40px -10px rgba(0, 0, 0, 0.15), 0 2px 10px -2px rgba(0, 0, 0, 0.04)',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        * { font-feature-settings: "cv02", "cv03", "cv04", "cv11"; }
        body {
            font-family: 'Inter', system-ui, sans-serif;
            font-optical-sizing: auto;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .drag-drop-zone {
            border: 2px dashed #d4d4d4;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.02) 0%, rgba(16, 185, 129, 0.02) 100%);
        }
        .drag-drop-zone.dragging {
            border-color: #0ea5e9;
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.08) 0%, rgba(16, 185, 129, 0.08) 100%);
            transform: scale(1.02);
        }
        .file-input { opacity: 0; position: absolute; width: 100%; height: 100%; cursor: pointer; }
        .progress-bar { transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .glass-effect {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gradient-text {
            background: linear-gradient(135deg, #0ea5e9, #10b981);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-neutral-50 via-white to-primary-50/30 min-h-screen">
    <!-- Navigation -->
    <nav class="glass-effect fixed w-full z-50 border-b border-white/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-18">
                <div class="flex items-center">
                    <a href="{% url 'landing' %}" class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-gradient-to-br from-primary-500 to-secondary-500 rounded-xl flex items-center justify-center">
                            <i class="ri-book-open-line text-white text-lg"></i>
                        </div>
                        <span class="text-2xl font-['Pacifico'] gradient-text">StudyPlan</span>
                        <span class="text-xs bg-primary-100 text-primary-700 px-2 py-1 rounded-full font-medium">AI</span>
                    </a>
                </div>
                <!-- Desktop Navigation -->
                <div class="hidden lg:flex items-center space-x-6">
                    <a href="{% url 'study_plans' %}" class="flex items-center space-x-2 text-neutral-600 hover:text-primary-600 transition-all duration-200 font-medium">
                        <i class="ri-book-open-line"></i>
                        <span>My Study Plans</span>
                    </a>
                    {% if user.is_authenticated %}
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center">
                                    <span class="text-primary-600 font-semibold text-sm">{{ user.first_name.0|default:user.username.0|upper }}</span>
                                </div>
                                <span class="text-neutral-700 font-medium hidden xl:block">{{ user.first_name|default:user.username }}</span>
                            </div>
                            <a href="{% url 'logout' %}" class="text-neutral-600 hover:text-neutral-800 font-medium transition-colors">Logout</a>
                        </div>
                    {% endif %}
                    <a href="{% url 'landing' %}" class="text-neutral-600 hover:text-primary-600 transition-all duration-200 font-medium">
                        <i class="ri-arrow-left-line mr-1"></i>Back to Home
                    </a>
                </div>

                <!-- Mobile menu button -->
                <div class="flex lg:hidden items-center">
                    <button id="mobile-menu-button" class="text-neutral-600 hover:text-primary-600 w-12 h-12 flex items-center justify-center rounded-xl hover:bg-white/50 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2">
                        <i id="menu-icon" class="ri-menu-line text-xl transition-transform duration-200"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Navigation Menu -->
        <div id="mobile-menu" class="lg:hidden fixed inset-x-0 top-18 bg-white/95 backdrop-blur-xl border-b border-neutral-200 transform -translate-y-full opacity-0 transition-all duration-300 ease-out">
            <div class="px-4 py-6 space-y-4">
                <!-- Navigation Links -->
                <div class="space-y-2">
                    <a href="{% url 'study_plans' %}" class="mobile-nav-link block px-4 py-3 text-neutral-700 hover:text-primary-600 hover:bg-primary-50 rounded-xl transition-all duration-200 font-medium">
                        <i class="ri-book-open-line mr-3"></i>My Study Plans
                    </a>
                    <a href="{% url 'landing' %}" class="mobile-nav-link block px-4 py-3 text-neutral-700 hover:text-primary-600 hover:bg-primary-50 rounded-xl transition-all duration-200 font-medium">
                        <i class="ri-arrow-left-line mr-3"></i>Back to Home
                    </a>
                </div>

                <!-- User Section -->
                {% if user.is_authenticated %}
                    <div class="border-t border-neutral-200 pt-4 space-y-2">
                        <div class="px-4 py-3 bg-primary-50 rounded-xl">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center">
                                    <span class="text-primary-600 font-semibold">{{ user.first_name.0|default:user.username.0|upper }}</span>
                                </div>
                                <div>
                                    <p class="font-semibold text-neutral-900">{{ user.first_name|default:user.username }}</p>
                                    <p class="text-sm text-neutral-600">{{ user.email }}</p>
                                </div>
                            </div>
                        </div>
                        <a href="{% url 'logout' %}" class="mobile-nav-link block px-4 py-3 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-xl transition-all duration-200 font-medium">
                            <i class="ri-logout-box-line mr-3"></i>Logout
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Upload Section -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 pt-32 pb-20">
        <!-- Breadcrumbs -->
        <nav class="flex mb-8" aria-label="Breadcrumb">
            <ol class="inline-flex items-center space-x-1 md:space-x-3">
                <li class="inline-flex items-center">
                    <a href="{% url 'landing' %}" class="inline-flex items-center text-sm font-medium text-neutral-500 hover:text-primary-600 transition-colors">
                        <i class="ri-home-line mr-2"></i>
                        Home
                    </a>
                </li>
                <li>
                    <div class="flex items-center">
                        <i class="ri-arrow-right-s-line text-neutral-400"></i>
                        <span class="ml-1 text-sm font-medium text-neutral-900 md:ml-2">Upload Document</span>
                    </div>
                </li>
            </ol>
        </nav>

        <!-- Progress Indicator -->
        <div class="mb-12">
            <!-- Desktop Progress Indicator -->
            <div class="hidden md:flex items-center justify-center space-x-4 mb-8">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-primary-500 text-white rounded-full flex items-center justify-center font-semibold">
                        1
                    </div>
                    <span class="ml-3 text-sm font-medium text-primary-600">Upload Document</span>
                </div>
                <div class="w-16 h-0.5 bg-neutral-200"></div>
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-neutral-200 text-neutral-500 rounded-full flex items-center justify-center font-semibold">
                        2
                    </div>
                    <span class="ml-3 text-sm font-medium text-neutral-500">AI Analysis</span>
                </div>
                <div class="w-16 h-0.5 bg-neutral-200"></div>
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-neutral-200 text-neutral-500 rounded-full flex items-center justify-center font-semibold">
                        3
                    </div>
                    <span class="ml-3 text-sm font-medium text-neutral-500">Study Plan</span>
                </div>
            </div>

            <!-- Mobile Progress Indicator -->
            <div class="md:hidden mb-8">
                <div class="flex items-center justify-between mb-4">
                    <span class="text-sm font-medium text-primary-600">Step 1 of 3</span>
                    <span class="text-sm text-neutral-500">Upload Document</span>
                </div>
                <div class="w-full bg-neutral-200 rounded-full h-2">
                    <div class="bg-primary-500 h-2 rounded-full" style="width: 33.33%"></div>
                </div>
            </div>
        </div>

        <div class="text-center mb-12">
            <div class="inline-flex items-center space-x-2 bg-primary-50 text-primary-700 px-4 py-2 rounded-full text-sm font-semibold mb-6">
                <i class="ri-upload-cloud-line"></i>
                <span>Document Upload</span>
            </div>
            <h1 class="text-4xl lg:text-5xl font-bold text-neutral-900 mb-6 leading-tight">
                Upload Your <span class="gradient-text">Document</span>
            </h1>
            <p class="text-xl text-neutral-600 max-w-2xl mx-auto leading-relaxed">
                Upload any PDF document and our AI will analyze it to create a personalized study plan with progress tracking.
            </p>
        </div>

        <!-- Upload Zone -->
        <div class="bg-white rounded-3xl shadow-large border border-neutral-100 p-10">
            <!-- Mode Selection -->
            <div class="mb-8">
                <label class="block text-sm font-semibold text-neutral-700 mb-4">Study Plan Mode</label>
                <div class="grid md:grid-cols-2 gap-4">
                    <label class="relative cursor-pointer">
                        <input type="radio" name="planMode" value="basic" class="peer sr-only" checked>
                        <div class="p-6 border-2 border-neutral-200 rounded-xl peer-checked:border-primary-500 peer-checked:bg-primary-50 transition-all duration-200 hover:border-primary-300">
                            <div class="flex items-start space-x-3">
                                <div class="w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <i class="ri-file-text-line text-primary-600 text-xl"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-bold text-neutral-900 mb-1">Basic Mode</h3>
                                    <p class="text-sm text-neutral-600">Generate a structured study plan from your document</p>
                                </div>
                            </div>
                        </div>
                    </label>
                    <label class="relative cursor-pointer">
                        <input type="radio" name="planMode" value="enhanced" class="peer sr-only">
                        <div class="p-6 border-2 border-neutral-200 rounded-xl peer-checked:border-secondary-500 peer-checked:bg-secondary-50 transition-all duration-200 hover:border-secondary-300">
                            <div class="flex items-start space-x-3">
                                <div class="w-10 h-10 bg-gradient-to-br from-secondary-100 to-primary-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <i class="ri-youtube-line text-secondary-600 text-xl"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-bold text-neutral-900 mb-1">Enhanced Mode ‚≠ê</h3>
                                    <p class="text-sm text-neutral-600">Study plan + YouTube videos + resources</p>
                                </div>
                            </div>
                        </div>
                    </label>
                </div>
            </div>

            <form id="uploadForm" method="POST" enctype="multipart/form-data">
                {% csrf_token %}

                <!-- Main Document Upload -->
                <div class="mb-6">
                    <label class="block text-sm font-semibold text-neutral-700 mb-3">Course Handout / Notes</label>
                    <div id="uploadSection" class="drag-drop-zone rounded-2xl p-6 md:p-12 text-center cursor-pointer relative group min-h-[250px] flex items-center justify-center">
                        <input type="file" class="file-input" accept=".pdf" id="fileInput" name="file">
                        <div class="space-y-4 md:space-y-6 w-full">
                            <div class="w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-primary-100 to-primary-200 rounded-2xl md:rounded-3xl mx-auto flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                                <i class="ri-file-pdf-line text-2xl md:text-3xl text-primary-600"></i>
                            </div>
                            <div class="space-y-2">
                                <p class="text-lg md:text-xl font-bold text-neutral-900">Drag and drop your PDF file here</p>
                                <p class="text-neutral-600 text-sm md:text-base">or tap to browse from your device</p>
                            </div>
                            <div class="flex flex-col sm:flex-row items-center justify-center space-y-2 sm:space-y-0 sm:space-x-6 text-sm text-neutral-500">
                                <div class="flex items-center space-x-2">
                                    <i class="ri-file-line"></i>
                                    <span>PDF files only</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <i class="ri-database-line"></i>
                                    <span>Max 50MB</span>
                                </div>
                            </div>

                            <!-- Mobile-friendly browse button -->
                            <div class="md:hidden mt-6">
                                <button type="button" class="w-full px-6 py-4 bg-primary-500 text-white font-semibold rounded-xl hover:bg-primary-600 transition-colors touch-manipulation" onclick="document.getElementById('fileInput').click()">
                                    <i class="ri-folder-open-line mr-2"></i>
                                    Browse Files
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Optional Syllabus Upload (Enhanced Mode Only) -->
                <div id="syllabusSection" class="mb-6 hidden">
                    <label class="block text-sm font-semibold text-neutral-700 mb-3">
                        Course Syllabus (Optional)
                        <span class="text-xs font-normal text-neutral-500 ml-2">Helps align study plan with course timeline</span>
                    </label>
                    <div class="border-2 border-dashed border-neutral-200 rounded-xl p-6 hover:border-secondary-300 transition-all duration-200">
                        <input type="file" accept=".pdf" id="syllabusInput" name="syllabus" class="hidden">
                        <button type="button" onclick="document.getElementById('syllabusInput').click()" class="w-full flex items-center justify-center space-x-2 text-neutral-600 hover:text-secondary-600 transition-colors">
                            <i class="ri-add-circle-line text-xl"></i>
                            <span class="font-medium">Add Syllabus (Optional)</span>
                        </button>
                        <div id="syllabusFileName" class="hidden mt-3 flex items-center justify-between bg-secondary-50 p-3 rounded-lg">
                            <div class="flex items-center space-x-2">
                                <i class="ri-file-pdf-line text-secondary-600"></i>
                                <span class="text-sm font-medium text-neutral-700" id="syllabusName"></span>
                            </div>
                            <button type="button" onclick="removeSyllabus()" class="text-neutral-400 hover:text-red-500 transition-colors">
                                <i class="ri-close-line"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Contextual Help -->
                <div class="mt-6 md:mt-8 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-4 md:p-6 border border-blue-100">
                    <div class="flex flex-col sm:flex-row items-start space-y-3 sm:space-y-0 sm:space-x-4">
                        <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center flex-shrink-0">
                            <i class="ri-lightbulb-line text-blue-600"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-semibold text-neutral-900 mb-3 text-sm md:text-base">üí° Tips for Best Results</h3>
                            <ul class="text-xs md:text-sm text-neutral-600 space-y-2">
                                <li class="flex items-start space-x-2">
                                    <i class="ri-check-line text-green-500 text-xs mt-0.5 flex-shrink-0"></i>
                                    <span>Upload textbooks, lecture notes, or course materials</span>
                                </li>
                                <li class="flex items-start space-x-2">
                                    <i class="ri-check-line text-green-500 text-xs mt-0.5 flex-shrink-0"></i>
                                    <span>Clear, readable text works best for AI analysis</span>
                                </li>
                                <li class="flex items-start space-x-2">
                                    <i class="ri-check-line text-green-500 text-xs mt-0.5 flex-shrink-0"></i>
                                    <span>Longer documents create more detailed study plans</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Upload Progress -->
                <div id="uploadProgress" class="mt-8 hidden opacity-0 transform translate-y-4 transition-all duration-500 ease-out">
                    <div class="bg-gradient-to-r from-primary-50 to-secondary-50 rounded-2xl p-6 border border-primary-100">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-primary-100 rounded-xl flex items-center justify-center animate-pulse">
                                <i class="ri-file-pdf-line text-xl text-primary-600"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="font-semibold text-neutral-900" id="fileName">filename.pdf</span>
                                    <span class="text-sm font-medium text-primary-600" id="progressPercent">0%</span>
                                </div>
                                <div class="bg-neutral-200 rounded-full h-3 overflow-hidden">
                                    <div class="progress-bar bg-gradient-to-r from-primary-500 to-secondary-500 h-3 rounded-full transition-all duration-300 ease-out" style="width: 0%"></div>
                                </div>
                                <div class="flex items-center justify-between mt-2 text-xs text-neutral-500">
                                    <span id="uploadStatus">Uploading...</span>
                                    <span id="uploadSpeed">--</span>
                                </div>
                            </div>
                            <button type="button" class="text-neutral-400 hover:text-red-500 transition-all duration-200 hover:scale-110" id="cancelUpload">
                                <i class="ri-close-line text-xl"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Upload Success -->
                <div id="uploadSuccess" class="mt-8 hidden opacity-0 transform translate-y-4 transition-all duration-500 ease-out">
                    <div class="bg-gradient-to-r from-secondary-50 to-primary-50 border border-secondary-200 rounded-2xl p-6 relative overflow-hidden">
                        <!-- Success Animation Background -->
                        <div class="absolute inset-0 bg-gradient-to-r from-secondary-100/20 to-primary-100/20 animate-pulse"></div>

                        <div class="relative flex items-center space-x-4">
                            <div class="w-12 h-12 bg-secondary-100 rounded-xl flex items-center justify-center animate-bounce">
                                <i class="ri-check-line text-xl text-secondary-600"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-bold text-neutral-900 flex items-center" id="successFileName">
                                    <span>Document uploaded successfully!</span>
                                    <i class="ri-check-double-line text-secondary-500 ml-2 animate-pulse"></i>
                                </h3>
                                <p class="text-neutral-600 text-sm">Ready for AI analysis</p>
                                <div class="flex items-center space-x-4 mt-3">
                                    <a href="#" id="viewPdfLink" class="inline-flex items-center space-x-1 text-sm text-primary-600 hover:text-primary-700 font-medium transition-colors" target="_blank">
                                        <i class="ri-eye-line"></i>
                                        <span>View PDF</span>
                                    </a>
                                    <button type="button" id="analyzeButton" class="inline-flex items-center space-x-1 px-4 py-2 bg-gradient-to-r from-primary-500 to-primary-600 text-white font-semibold rounded-lg hover:from-primary-600 hover:to-primary-700 transition-all duration-200 shadow-soft hover:shadow-medium">
                                        <i class="ri-ai-generate"></i>
                                        <span>Analyze Document</span>
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 bg-secondary-100 rounded-full flex items-center justify-center">
                                    <i class="ri-check-line text-secondary-600 text-sm"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Upload Error -->
                <div id="uploadError" class="mt-8 hidden opacity-0 transform translate-y-4 transition-all duration-500 ease-out">
                    <div class="bg-gradient-to-r from-red-50 to-orange-50 border border-red-200 rounded-2xl p-6">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center">
                                <i class="ri-error-warning-line text-xl text-red-600"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-bold text-neutral-900">Upload Failed</h3>
                                <p class="text-neutral-600 text-sm" id="errorMessage">Something went wrong. Please try again.</p>
                                <button id="retryUpload" class="inline-flex items-center space-x-1 text-sm text-red-600 hover:text-red-700 font-medium mt-2 transition-colors">
                                    <i class="ri-refresh-line"></i>
                                    <span>Try Again</span>
                                </button>
                            </div>
                            <button type="button" class="text-neutral-400 hover:text-red-500 transition-colors" id="dismissError">
                                <i class="ri-close-line text-xl"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Analysis Loading -->
                <div id="analysisLoading" class="mt-8 hidden opacity-0 transform translate-y-4 transition-all duration-500 ease-out">
                    <div class="bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-2xl p-6">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                                <i class="ri-ai-generate text-xl text-purple-600 animate-spin"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-bold text-neutral-900">AI Analysis in Progress</h3>
                                <p class="text-neutral-600 text-sm">Our AI is analyzing your document and creating a personalized study plan...</p>
                                <div class="mt-3 flex items-center space-x-2">
                                    <div class="flex space-x-1">
                                        <div class="w-2 h-2 bg-purple-400 rounded-full animate-bounce"></div>
                                        <div class="w-2 h-2 bg-purple-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                                        <div class="w-2 h-2 bg-purple-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                                    </div>
                                    <span class="text-xs text-neutral-500">This may take a few moments</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile Menu Functionality
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const menuIcon = document.getElementById('menu-icon');
            let isMenuOpen = false;

            function toggleMobileMenu() {
                isMenuOpen = !isMenuOpen;

                if (isMenuOpen) {
                    // Open menu
                    mobileMenu.classList.remove('-translate-y-full', 'opacity-0');
                    mobileMenu.classList.add('translate-y-0', 'opacity-100');
                    menuIcon.classList.remove('ri-menu-line');
                    menuIcon.classList.add('ri-close-line', 'rotate-180');
                    document.body.style.overflow = 'hidden'; // Prevent scrolling
                } else {
                    // Close menu
                    mobileMenu.classList.remove('translate-y-0', 'opacity-100');
                    mobileMenu.classList.add('-translate-y-full', 'opacity-0');
                    menuIcon.classList.remove('ri-close-line', 'rotate-180');
                    menuIcon.classList.add('ri-menu-line');
                    document.body.style.overflow = ''; // Restore scrolling
                }
            }

            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', toggleMobileMenu);

                // Close menu when clicking on navigation links
                const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
                mobileNavLinks.forEach(link => {
                    link.addEventListener('click', () => {
                        if (isMenuOpen) {
                            toggleMobileMenu();
                        }
                    });
                });

                // Close menu when clicking outside
                document.addEventListener('click', function(event) {
                    if (isMenuOpen && !mobileMenuButton.contains(event.target) && !mobileMenu.contains(event.target)) {
                        toggleMobileMenu();
                    }
                });

                // Close menu on escape key
                document.addEventListener('keydown', function(event) {
                    if (event.key === 'Escape' && isMenuOpen) {
                        toggleMobileMenu();
                    }
                });

                // Handle window resize
                window.addEventListener('resize', function() {
                    if (window.innerWidth >= 1024 && isMenuOpen) { // lg breakpoint
                        toggleMobileMenu();
                    }
                });
            }

            // Upload functionality with enhanced feedback
            const dropZone = document.querySelector('.drag-drop-zone');
            const fileInput = document.querySelector('.file-input');
            const uploadSection = document.getElementById('uploadSection');
            const uploadProgress = document.getElementById('uploadProgress');
            const uploadSuccess = document.getElementById('uploadSuccess');
            const uploadError = document.getElementById('uploadError');
            const analysisLoading = document.getElementById('analysisLoading');
            const form = document.getElementById('uploadForm');

            // Enhanced progress elements
            const fileName = document.getElementById('fileName');
            const progressBar = document.querySelector('.progress-bar');
            const progressPercent = document.getElementById('progressPercent');
            const uploadStatus = document.getElementById('uploadStatus');
            const uploadSpeed = document.getElementById('uploadSpeed');
            const successFileName = document.getElementById('successFileName');
            const viewPdfLink = document.getElementById('viewPdfLink');
            const analyzeButton = document.getElementById('analyzeButton');
            const cancelUpload = document.getElementById('cancelUpload');
            const retryUpload = document.getElementById('retryUpload');
            const dismissError = document.getElementById('dismissError');
            const errorMessage = document.getElementById('errorMessage');

            let uploadController = null;
            let uploadStartTime = 0;
            let uploadedFileUrl = null;
            let uploadedSyllabusUrl = null;

            // Mode selection handling
            const planModeRadios = document.querySelectorAll('input[name="planMode"]');
            const syllabusSection = document.getElementById('syllabusSection');
            const syllabusInput = document.getElementById('syllabusInput');
            const syllabusFileName = document.getElementById('syllabusFileName');
            const syllabusName = document.getElementById('syllabusName');

            planModeRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    if (e.target.value === 'enhanced') {
                        syllabusSection.classList.remove('hidden');
                    } else {
                        syllabusSection.classList.add('hidden');
                        removeSyllabus();
                    }
                });
            });

            // Syllabus file handling
            syllabusInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    syllabusName.textContent = file.name;
                    syllabusFileName.classList.remove('hidden');
                }
            });

            window.removeSyllabus = function() {
                syllabusInput.value = '';
                syllabusFileName.classList.add('hidden');
                uploadedSyllabusUrl = null;
            };

            // Drag and drop handlers
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });

            function highlight() { dropZone.classList.add('dragging'); }
            function unhighlight() { dropZone.classList.remove('dragging'); }

            dropZone.addEventListener('drop', handleDrop, false);
            fileInput.addEventListener('change', handleFileSelect, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }

            function handleFileSelect(e) {
                const files = e.target.files;
                handleFiles(files);
            }

            function handleFiles(files) {
                if (files.length === 0) return;
                const file = files[0];
                if (!validateFile(file)) return;

                // Hide all states first
                hideAllStates();

                // Show upload progress with animation
                showUploadProgress();

                uploadFile(file);
            }

            function hideAllStates() {
                uploadSection.classList.add('hidden');
                uploadProgress.classList.add('hidden', 'opacity-0', 'translate-y-4');
                uploadSuccess.classList.add('hidden', 'opacity-0', 'translate-y-4');
                uploadError.classList.add('hidden', 'opacity-0', 'translate-y-4');
                analysisLoading.classList.add('hidden', 'opacity-0', 'translate-y-4');
            }

            function showUploadProgress() {
                uploadProgress.classList.remove('hidden');
                setTimeout(() => {
                    uploadProgress.classList.remove('opacity-0', 'translate-y-4');
                    uploadProgress.classList.add('opacity-100', 'translate-y-0');
                }, 50);
            }

            function showUploadSuccess() {
                uploadProgress.classList.add('opacity-0', 'translate-y-4');
                setTimeout(() => {
                    uploadProgress.classList.add('hidden');
                    uploadSuccess.classList.remove('hidden');
                    setTimeout(() => {
                        uploadSuccess.classList.remove('opacity-0', 'translate-y-4');
                        uploadSuccess.classList.add('opacity-100', 'translate-y-0');
                    }, 50);
                }, 300);
            }

            function showUploadError(message) {
                uploadProgress.classList.add('opacity-0', 'translate-y-4');
                setTimeout(() => {
                    uploadProgress.classList.add('hidden');
                    uploadError.classList.remove('hidden');
                    errorMessage.textContent = message;
                    setTimeout(() => {
                        uploadError.classList.remove('opacity-0', 'translate-y-4');
                        uploadError.classList.add('opacity-100', 'translate-y-0');
                    }, 50);
                }, 300);
            }

            function showAnalysisLoading() {
                uploadSuccess.classList.add('opacity-0', 'translate-y-4');
                setTimeout(() => {
                    uploadSuccess.classList.add('hidden');
                    analysisLoading.classList.remove('hidden');
                    setTimeout(() => {
                        analysisLoading.classList.remove('opacity-0', 'translate-y-4');
                        analysisLoading.classList.add('opacity-100', 'translate-y-0');
                    }, 50);
                }, 300);
            }

            function validateFile(file) {
                const allowedTypes = ['application/pdf'];
                const maxSize = 50 * 1024 * 1024; // 50MB

                if (!allowedTypes.includes(file.type)) {
                    showUploadError('Please upload a PDF file.');
                    return false;
                }

                if (file.size > maxSize) {
                    showUploadError('File size exceeds 50MB limit.');
                    return false;
                }

                return true;
            }

            function simulateProgress() {
                let progress = 0;
                const interval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress > 90) progress = 90; // Stop at 90% until real completion

                    progressBar.style.width = progress + '%';
                    progressPercent.textContent = Math.round(progress) + '%';

                    // Update status messages
                    if (progress < 30) {
                        uploadStatus.textContent = 'Uploading...';
                    } else if (progress < 60) {
                        uploadStatus.textContent = 'Processing...';
                    } else if (progress < 90) {
                        uploadStatus.textContent = 'Almost done...';
                    }

                    // Calculate and show upload speed
                    const elapsed = (Date.now() - uploadStartTime) / 1000;
                    const speed = (progress / 100) * (fileName.textContent.length * 1000) / elapsed; // Rough estimate
                    uploadSpeed.textContent = formatBytes(speed) + '/s';

                    if (progress >= 90) {
                        clearInterval(interval);
                    }
                }, 200);
            }

            function formatBytes(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            function showError(message) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded z-50';
                errorDiv.innerHTML = '<span>' + message + '</span><span class="absolute top-0 bottom-0 right-0 px-4 py-3 cursor-pointer" onclick="this.parentElement.remove()">√ó</span>';
                document.body.appendChild(errorDiv);
                setTimeout(() => errorDiv.remove(), 5000);
            }

            function uploadFile(file) {
                fileName.textContent = file.name;
                uploadStartTime = Date.now();

                // Simulate progress for better UX
                simulateProgress();

                const formData = new FormData(form);
                formData.append('file', file);

                // Add syllabus if in enhanced mode and syllabus is selected
                const selectedMode = document.querySelector('input[name="planMode"]:checked').value;
                if (selectedMode === 'enhanced' && syllabusInput.files.length > 0) {
                    formData.append('syllabus', syllabusInput.files[0]);
                }

                uploadController = new AbortController();

                fetch('{% url "upload" %}', {
                    method: 'POST',
                    body: formData,
                    signal: uploadController.signal,
                    headers: { 'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Store uploaded file URLs
                        uploadedFileUrl = data.file_url;
                        if (data.syllabus_uploaded) {
                            uploadedSyllabusUrl = data.syllabus_url;
                        }

                        // Complete progress animation
                        progressBar.style.width = '100%';
                        progressPercent.textContent = '100%';
                        uploadStatus.textContent = 'Upload complete!';

                        setTimeout(() => {
                            showUploadSuccess();
                            successFileName.textContent = data.file_name;
                            if (data.syllabus_uploaded) {
                                successFileName.textContent += ' + Syllabus';
                            }
                            viewPdfLink.href = data.file_url;
                        }, 500);
                    } else {
                        throw new Error(data.error);
                    }
                })
                .catch(error => {
                    showUploadError(error.message || 'Upload failed. Please try again.');
                });
            }

            // Enhanced event handlers
            if (cancelUpload) {
                cancelUpload.addEventListener('click', () => {
                    if (uploadController) {
                        uploadController.abort();
                    }
                    hideAllStates();
                    uploadSection.classList.remove('hidden');
                });
            }

            if (retryUpload) {
                retryUpload.addEventListener('click', () => {
                    hideAllStates();
                    uploadSection.classList.remove('hidden');
                });
            }

            if (dismissError) {
                dismissError.addEventListener('click', () => {
                    uploadError.classList.add('opacity-0', 'translate-y-4');
                    setTimeout(() => {
                        uploadError.classList.add('hidden');
                        uploadSection.classList.remove('hidden');
                    }, 300);
                });
            }

            // Enhanced analyze button functionality
            if (analyzeButton) {
                analyzeButton.addEventListener('click', async (event) => {
                    event.preventDefault(); // Prevent form submission

                    if (!viewPdfLink || !viewPdfLink.href) {
                        showUploadError('No PDF file available for analysis');
                        return;
                    }

                    // Show analysis loading state
                    showAnalysisLoading();

                    try {
                        // Get selected plan mode
                        const selectedMode = document.querySelector('input[name="planMode"]:checked').value;

                        // Prepare request body
                        const requestBody = {
                            file_url: uploadedFileUrl || viewPdfLink.href,
                            plan_mode: selectedMode
                        };

                        // Add syllabus URL if available
                        if (uploadedSyllabusUrl) {
                            requestBody.syllabus_url = uploadedSyllabusUrl;
                        }

                        const response = await fetch('/analyze/', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                            },
                            body: JSON.stringify(requestBody)
                        });

                        const data = await response.json();
                        if (data.success) {
                            if (data.study_plan_id) {
                                // Show success message before redirect
                                analysisLoading.querySelector('h3').textContent = 'Study Plan Created!';
                                analysisLoading.querySelector('p').textContent = 'Redirecting to your personalized study plan...';
                                analysisLoading.querySelector('.ri-ai-generate').classList.remove('animate-spin');
                                analysisLoading.querySelector('.ri-ai-generate').classList.add('ri-check-line');

                                setTimeout(() => {
                                    window.location.href = '/study-plan/' + data.study_plan_id + '/';
                                }, 2000);
                            } else {
                                // Fallback: display the study plan inline
                                displayStudyPlan(JSON.parse(data.result));
                            }
                        } else {
                            throw new Error(data.error);
                        }
                    } catch (error) {
                        showUploadError(error.message || 'Analysis failed. Please try again.');
                    }
                });
            }

            function displayStudyPlan(studyPlan) {
                const resultsDiv = document.createElement('div');
                resultsDiv.className = 'mt-6 bg-white rounded-lg shadow-sm p-6 study-plan-results';
                
                let html = '<div class="mb-6"><h2 class="text-2xl font-bold text-primary mb-2">' + studyPlan.course_name + '</h2>';
                html += '<p class="text-gray-600">' + (studyPlan.course_description || 'Your personalized study plan') + '</p></div>';
                html += '<div class="space-y-4">';
                
                studyPlan.study_plan.forEach(week => {
                    html += '<div class="border border-gray-200 rounded-lg p-4">';
                    html += '<div class="flex items-center mb-3">';
                    html += '<div class="w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center mr-3">';
                    html += '<span class="text-primary font-semibold">' + week.week + '</span></div>';
                    html += '<h3 class="text-lg font-semibold text-gray-900">' + week.topic + '</h3></div>';
                    
                    if (week.estimated_hours) {
                        html += '<p class="text-sm text-gray-600 mb-2">Estimated time: ' + week.estimated_hours + ' hours</p>';
                    }
                    
                    if (week.study_activities) {
                        html += '<div class="space-y-2">';
                        week.study_activities.forEach(activity => {
                            html += '<div class="bg-gray-50 p-2 rounded text-sm">';
                            html += '<strong>' + activity.type + ':</strong> ' + activity.description;
                            html += ' <span class="text-gray-500">(' + activity.estimated_time + ')</span></div>';
                        });
                        html += '</div>';
                    }
                    
                    html += '</div>';
                });
                
                html += '</div>';
                resultsDiv.innerHTML = html;
                
                const existingResults = document.querySelector('.study-plan-results');
                if (existingResults) existingResults.remove();
                
                uploadSuccess.parentNode.insertBefore(resultsDiv, uploadSuccess.nextSibling);
            }
        });
    </script>
</body>
</html>
